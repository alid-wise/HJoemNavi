#!/usr/bin/perl
$|=1;
use strict;

#		// The fields are ordered to reduce memory over caused by struct-padding
#		uint8_t       rcvstate;        // State Machine state
#		uint8_t       recvpin;         // Pin connected to IR data from detector
#		uint8_t       blinkpin;
#		uint8_t       blinkflag;       // true -> enable blinking of pin on IR processing
#		uint8_t       rawlen;          // counter of entries in rawbuf
#		unsigned int  timer;           // State timer, counts 50uS ticks.
#		unsigned int  rawbuf[RAWBUF];  // raw data
#		uint8_t       overflow;        // Raw buffer overflow occurred

my $USECPERTICK = 50;	# 50 мкс - разрешение таймера
my $SYMBOL_LENGTH = 200 / $USECPERTICK;	# длина бита
my $SYMBOL_LENGTH_TOLERANCE = $SYMBOL_LENGTH / 2;	# для округления
my $KEY_LENGTH = 10950 / $USECPERTICK;	# длина ключа
my $keyname;
my $rawlen;
my @rawbuf;

while(<DATA>) {
	chomp;
	my $str = $_;
	if($str =~ m/^\D/) {
		$keyname = $str;
		print "[$keyname]\n";
		next;
	}
	(@rawbuf) = split(/\s/,$str);
	$rawlen = scalar @rawbuf;
	my $key_length;
	map { $_ /= $USECPERTICK; $key_length += abs($_); } @rawbuf;
#	print "key length: $key_length rawlen: $rawlen\n";
#	next	unless($key_length == $KEY_LENGTH);
	my $bkey = '';
	for(my $i=0; $i<$rawlen; $i++) {
		my $l = abs(int($rawbuf[$i] / $SYMBOL_LENGTH));
#		$l++	if(abs(int($rawbuf[$i] % $SYMBOL_LENGTH)) >= $SYMBOL_LENGTH_TOLERANCE);
		my $s = ($rawbuf[$i]>0) ? '1':'0';
		while($l) {
			$bkey .= $s;
			$l--;
		}		
	}
#print "[$bkey]\n";
#print "[".substr("0" x 32 . $bkey, -32)."]\n";
print unpack("H32", pack("B32", substr("0" x 32 . $bkey, -32)))."\n";
}

__DATA__
 audio
1650 -1250 2050 -950 1450 -200 200 -1150 200 -1250 600 
cancel
1650 -1200 2050 -950 1250 -200 450 -1100 200 -1050 200 -250 400 
map
1650 -1250 200 -200 1450 -1150 2050 -950 400 -1250 400 
menu
1650 -1200 1250 -200 400 -1150 2050 -950 200 -1050 200 -200 450 
*)
1650 -1200 400 -200 1250 -1150 2100 -900 200 -250 200 -1000 450 
info
1650 -1200 1050 -200 600 -1150 2100 -900 200 -850 200 -450 400 
enter
1650 -1200 1450 -200 200 -1150 2100 -950 200 -1250 600 
<---
200 -1650 250 -750 2100 -900 2100 -900 2100 
200 -1700 200 -650 2100 -950 2050 -950 2050 
200 -1650 200 -700 2050 -950 2100 -900 2100 
200 -1650 250 -650 2100 -900 2100 -950 2050 
200 -1650 200 -800 2050 -950 2100 -900 2100 
200 -1650 200 -800 2050 -950 2100 -900 2100 
200 -1700 200 -650 2100 -900 2100 -950 2050 
250 -1650 200 -700 2050 -950 2050 -950 2050 
200 -1650 200 -700 2050 -950 2100 -900 2100 
200 -1650 200 -700 2050 -950 2100 -900 2100 
-->
200 -200 1250 -200 200 -700 2100 -900 2100 -950 400 -1250 400 
200 -200 1250 -200 200 -700 2050 -950 2050 -950 400 -1250 400 
200 -200 1250 -200 200 -800 2050 -950 2050 -950 400 -1250 400 
200 -200 1250 -200 200 -800 2050 -950 2050 -950 400 -1250 450 
200 -200 1250 -200 200 -700 2050 -950 2100 -900 450 -1250 400 
200 -200 1250 -200 200 -700 2100 -900 2100 -950 400 -1250 400 
200 -200 1250 -200 200 -800 2050 -950 2050 -950 400 -1250 400 
200 -250 1200 -250 200 -650 2100 -950 2050 -950 400 -1250 400 
200 -200 1250 -200 200 -700 2050 -950 2050 -950 400 -1250 450 
200 -200 1250 -200 200 -800 2050 -950 2050 -950 400 -1250 400 
joistick <--
1650 -1200 2050 -950 200 -200 1450 -1150 400 -1250 450 
1650 -1200 2050 -950 200 -200 1450 -1150 400 -1250 450 
1650 -1200 2050 -950 200 -200 1450 -1150 400 -1250 450 
1650 -1200 2050 -950 200 -200 1450 -1150 400 -1250 450 
1650 -1200 2050 -950 200 -200 1450 -1150 400 -1250 450 
1650 -1200 2050 -950 200 -200 1450 -1150 400 -1250 450 
1650 -1200 2050 -950 200 -200 1450 -1150 400 -1250 450 
1650 -1200 2050 -950 200 -200 1450 -1150 400 -1250 450 
1650 -1200 2050 -950 200 -200 1450 -1150 400 -1250 450 
1650 -1200 2050 -950 200 -200 1450 -1150 450 -1200 450 
1650 -1200 2050 -950 200 -200 1450 -1150 450 -1200 450 
1650 -1200 2050 -950 200 -200 1450 -1150 450 -1200 450 
1650 -1200 2050 -950 200 -250 1400 -1150 450 -1200 450 
1650 -1200 2050 -950 2050 -950 200 -1450 200 
-->
1650 -1200 2050 -950 600 -200 1050 -1150 200 -400 200 -850 400 
1650 -1200 2050 -950 600 -200 1050 -1150 200 -400 200 -850 400 
1650 -1200 2050 -950 600 -200 1050 -1150 200 -400 250 -800 400 
1650 -1200 2050 -950 600 -200 1050 -1150 200 -400 250 -800 400 
1650 -1200 2050 -950 600 -200 1050 -1150 200 -450 200 -800 450 
1650 -1200 2050 -950 600 -200 1050 -1150 200 -450 200 -800 400 
1650 -1200 2050 -950 600 -200 1050 -1150 200 -450 200 -800 450 
1650 -1200 2050 -950 600 -200 1050 -1150 200 -450 200 -800 450 
1650 -1200 2050 -950 600 -250 1000 -1150 200 -450 200 -800 450 
1650 -1200 2050 -950 600 -250 1000 -1150 200 -450 200 -800 450 
1650 -1200 2050 -950 600 -250 1000 -1150 200 -450 200 -800 450 
1650 -1200 2050 -950 600 -250 1000 -1150 200 -450 200 -800 450 
1650 -1200 2050 -950 600 -250 1000 -1150 200 -450 200 -800 450 
1650 -1200 2050 -950 600 -250 1000 -1150 200 -450 200 -800 450 
up
1650 -1200 2050 -950 850 -200 800 -1150 200 -650 200 -600 450 
1650 -1200 2050 -950 850 -200 800 -1150 200 -650 200 -600 450 
1650 -1200 2050 -950 850 -200 800 -1150 200 -650 200 -600 450 
1650 -1200 2050 -950 850 -200 800 -1150 200 -650 200 -600 450 
1650 -1200 2050 -950 850 -200 800 -1150 200 -650 200 -650 400 
1650 -1200 2050 -950 850 -200 800 -1150 200 -650 200 -600 450 
1650 -1200 2050 -950 850 -200 800 -1150 200 -650 200 -650 400 
1650 -1200 2050 -950 850 -200 800 -1150 200 -650 200 -650 400 
1650 -1200 2050 -950 850 -200 800 -1150 250 -600 200 -650 400 
1650 -1200 2050 -950 850 -200 800 -1150 200 -650 200 -650 400 
1650 -1200 2050 -950 850 -200 850 -1100 250 -600 200 -650 400 
down
1650 -1200 2050 -950 400 -200 1250 -1150 200 -200 200 -1050 400 
1650 -1200 2050 -950 400 -200 1250 -1150 200 -200 200 -1050 400 
1650 -1200 2050 -950 400 -200 1250 -1150 200 -200 200 -1050 450 
1650 -1200 2050 -950 400 -200 1250 -1150 200 -200 200 -1050 450 
1650 -1200 2050 -950 400 -200 1250 -1150 200 -250 200 -1000 450 
1650 -1200 2050 -950 400 -200 1250 -1150 200 -250 200 -1000 450 
1650 -1200 2050 -950 400 -200 1250 -1150 200 -250 200 -1000 450 
1650 -1200 2050 -950 400 -200 1250 -1150 200 -250 200 -1000 450 
1650 -1200 2050 -950 400 -200 1250 -1150 200 -250 200 -1000 450 
1650 -1200 2050 -950 400 -250 1200 -1150 200 -250 200 -1000 450 
1650 -1200 2050 -950 400 -250 1200 -1150 200 -250 200 -1000 450 
1650 -1200 2050 -950 400 -250 1200 -1150 200 -250 200 -1000 450 
<up
1650 -1200 2100 -950 200 -200 400 -200 1050 -950 400 -400 200 -650 200 
1650 -1200 2100 -950 200 -200 400 -200 1050 -950 400 -400 200 -650 200 
1650 -1200 2100 -950 200 -200 400 -200 1050 -950 400 -400 200 -650 200 
1650 -1200 2100 -950 200 -200 400 -200 1050 -950 400 -400 200 -650 200 
1650 -1200 2100 -950 200 -200 400 -200 1050 -950 400 -400 200 -650 200 
1650 -1200 2100 -950 200 -200 400 -200 1050 -950 400 -400 200 -650 200 
>up
1650 -1200 2050 -950 650 -400 1050 -900 250 -400 400 -650 200 
1650 -1200 2050 -950 650 -400 1050 -900 200 -450 400 -650 200 
1650 -1200 2100 -900 650 -400 1050 -900 200 -450 400 -650 200 
1650 -1200 2100 -900 650 -400 1050 -900 250 -400 400 -650 200 
1650 -1200 2100 -900 650 -400 1050 -900 250 -400 400 -650 200 
1650 -1200 2100 -900 650 -400 1050 -900 250 -400 400 -650 200 
1650 -1200 2100 -900 650 -400 1050 -900 250 -400 400 -650 200 
1650 -1200 2100 -900 650 -400 1050 -900 250 -400 400 -650 200 
1650 -1200 2100 -900 650 -400 1050 -900 250 -400 400 -650 200 
1650 -1200 2100 -900 650 -400 1050 -950 200 -400 400 -650 200 
<down
1650 -1200 2100 -900 250 -400 1450 -950 600 -1050 200 
1650 -1200 2100 -900 250 -400 1450 -950 600 -1050 200 
1650 -1200 2100 -900 250 -400 1450 -950 600 -1050 200 
1650 -1200 2100 -900 250 -400 1450 -950 600 -1050 200 
1650 -1200 2100 -900 250 -400 1450 -950 600 -1050 200 
1650 -1200 2100 -900 250 -400 1450 -950 600 -1050 200 
>down
1650 -1200 2100 -900 450 -400 1250 -950 200 -200 400 -850 200 
1650 -1200 2100 -900 450 -400 1250 -950 200 -200 400 -850 200 
1650 -1200 2100 -900 450 -400 1250 -950 200 -200 400 -850 200 
1650 -1200 2100 -900 450 -400 1250 -900 250 -200 400 -850 200 
1650 -1200 2100 -900 450 -400 1250 -900 250 -200 400 -850 200 
1650 -1200 2100 -900 450 -400 1250 -950 200 -200 400 -850 200 
1650 -1200 2100 -900 450 -400 1250 -900 250 -200 400 -850 200 
1650 -1200 2100 -900 450 -400 1250 -950 200 -200 400 -850 200 
